// Copyright (c) 2022 Ziga Miklosic
// All Rights Reserved
// This software is under MIT licence (https://opensource.org/licenses/MIT)
////////////////////////////////////////////////////////////////////////////////
/**
*@file      timer.c
*@brief     Timer low level driver
*@author    Ziga Miklosic
*@date      23.11.2022
*@version   V1.0.0  (nRF5)
*/
////////////////////////////////////////////////////////////////////////////////
/*!
* @addtogroup TIMER
* @{ <!-- BEGIN GROUP -->
*/
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes
////////////////////////////////////////////////////////////////////////////////
#include <stdint.h>
#include <stdbool.h>
#include <stdlib.h>
#include "timer.h"
#include "nrf_gpio.h"
#include "nrf_drv_pwm.h"

#include "pin_mapper.h"
#include "project_config.h"

////////////////////////////////////////////////////////////////////////////////
// Definitions
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Variables
////////////////////////////////////////////////////////////////////////////////

/**
 * Initialization guards
 */
static bool gb_is_init = false;


////////////////////////////////////////////////////////////////////////////////
// Functions
////////////////////////////////////////////////////////////////////////////////










////////////////////////////////////////////////////////////////////////////////
/*!
 * @} <!-- END GROUP -->
 */
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
/**
*@addtogroup TIMER_API
* @{ <!-- BEGIN GROUP -->
*
* 	Following functions are part of API calls.
*/
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
/**
*		Timer initialization
*
* @return 		status - Status of operation
*/
////////////////////////////////////////////////////////////////////////////////
timer_status_t timer_init(void)
{
    timer_status_t status = eTIMER_OK;

    if ( false == gb_is_init )
    {
        


        // Init success
        if ( eTIMER_OK == status )
        {
            gb_is_init = true;
        }
    }
    else
    {
        status = eTIMER_ERROR;
    }

    return status;
}

////////////////////////////////////////////////////////////////////////////////
/**
*		Set timer PWM duty
*
* @param[in] 	ch 		- Channel number
* @param[in] 	duty 	- Duty cycle in range 0.0-1.0
* @return 		status 	- Status of operation
*/
////////////////////////////////////////////////////////////////////////////////
timer_status_t timer_set_pwm(const timer_ch_t ch, const float32_t duty)
{
    timer_status_t status = eTIMER_OK;

    PROJECT_CONFIG_ASSERT( true == gb_is_init );
    PROJECT_CONFIG_ASSERT( ch < eTIMER_CH_NUM_OF );

    if  (   ( true == gb_is_init )
        &&  ( ch < eTIMER_CH_NUM_OF ))
    {
        if (( duty >= 0.0f ) && ( duty <= 1.0f ))
		{
			// TODO: Set duty
		}
		else
		{
			status = eTIMER_ERROR;
		}
    }
    else
    {
        status = eTIMER_ERROR;
    }

    return status;   
}
    

////////////////////////////////////////////////////////////////////////////////
/**
* @} <!-- END GROUP -->
*/
////////////////////////////////////////////////////////////////////////////////
